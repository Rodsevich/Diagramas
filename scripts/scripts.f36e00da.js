"use strict";angular.module("diagramasApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","firebase","firebase.utils","simpleLogin","ngDraggable"]),angular.module("diagramasApp").controller("MainCtrl",["$scope","joint","elementosJoint","enlacesJoint",function(a,b,c,d){a.elementos={},a.modo="",a.enlaces=[],a.diagrama=new b.dia.Graph,a.conectorElegido="",a.papel_diagrama=new b.dia.Paper({el:$("#hoja"),width:$("#hoja").width(),height:$("#hoja").height(),model:a.diagrama,linkConnectionPoint:b.util.shapePerimeterConnectionPoint,gridSize:1}),a.onDropComplete=function(b,c){var d=c.x-a.papel_diagrama.el.offsetLeft-parseInt(a.papel_diagrama.$el.css("padding-left"),10)-c.element.centerX,e=c.y-a.papel_diagrama.el.offsetTop-parseInt(a.papel_diagrama.$el.css("padding-top"),10)-c.element.centerY,f=b.clone();f.translate(d,e),a.diagrama.addCell(f),f.toFront()},a.figuras=[];var e=0;for(var f in c){a.elementos[f]=new c[f],a.elementos[f].set("inPorts",["in1","in2"]),a.elementos[f].set("outPorts",["out"]),a.elementos[f].set(a.elementos[f].editables[0],f),a.diagrama.addCell(a.elementos[f]);var g=a.elementos[f].findView(a.papel_diagrama).getBBox(),h=Math.abs(g.x)+2,i=Math.abs(g.y)-2;a.elementos[f].translate(h,i),a.figuras[e]=a.papel_diagrama.findViewByModel(a.elementos[f]).$el.clone(),a.figuras[e].id=b.util.uuid(),a.figuras[e].ancho=g.width,a.figuras[e].alto=g.height,a.figuras[e++].referenciaElemento=a.elementos[f]}a.conectores=[],e=0;for(var j in d)a.enlaces[j]=new d[j]({source:{x:10,y:50},target:{x:110,y:50},vertices:[{x:40,y:20},{x:70,y:80}]}),a.enlaces[j].label(0,{position:.5,attrs:{rect:{fill:"white"},text:{fill:"black",text:j}}}),a.diagrama.addCell(a.enlaces[j]),a.conectores[e]=a.papel_diagrama.findViewByModel(a.enlaces[j]).$el.clone(),a.conectores[e].indice=e,a.conectores[e].nombre=j,a.conectores[e++].id=b.util.uuid();a.seleccionarConector=function(b){b=b.indice,""!==a.conectorElegido?($("#conector"+a.conectorElegido)[0].classList.remove("elegido"),a.conectorElegido!=b?(a.conectorElegido=b,$("#conector"+a.conectorElegido)[0].classList.add("elegido"),a.modo="enlace"):(a.modo="",a.conectorElegido="")):(a.conectorElegido=b,$("#conector"+a.conectorElegido)[0].classList.add("elegido"),a.modo="enlace")},document.onkeypress=function(b){if(null!=a.elemFoco){b=b||window.event;var c=a.diagrama.getCell(a.elemFoco.model.id),d=c.getBBox(),e=b.shiftKey?10:1;("+"==b.key||43==b.charCode)&&c.resize(d.width+e,d.height+e),("-"==b.key||45==b.charCode)&&c.resize(d.width-e,d.height-e)}},a.papel_diagrama.on("blank:pointerclick",function(b,c,d,e){null!=a.elemFoco&&(a.elemFoco.unhighlight(),a.elemFoco=null)}),a.papel_diagrama.on("cell:pointerclick",function(b,c,d,e){c.ctrlKey&&(null==a.elemFoco?(a.elemFoco=b,b.highlight()):(a.elemFoco.unhighlight(),a.elemFoco==b?a.elemFoco=null:(b.highlight(),a.elemFoco=b)))}),a.papel_diagrama.on("cell:pointerdblclick",function(b,c,e,f){switch(a.modo){case"borrado":a.diagrama.getCell(b.model.id).remove();break;case"enlace":if(a.enlaceAux){var g=new d[a.conectores[a.conectorElegido].nombre];g.set("source",{id:a.enlaceAux.model.id}),g.set("target",{id:b.model.id}),a.diagrama.addCell(g),a.enlaceAux.unhighlight(),a.enlaceAux=void 0,a.modo=""}else a.enlaceAux=b,b.highlight();break;default:for(var h=a.diagrama.getCell(b.model.id),i=h.editables,j=0;j<i.length;j++){var k=b.$(h.editablesRenderizadosEnVista[j]);if(1!=k.length)throw new Error(h.attributes.type+".editablesRenderizadosEnVista esta mal definido");k=k[0];var l=document.createElement("textarea"),m=l.style;$("body").append(l);var n=k.getBoundingClientRect();m.position="absolute",m.top=parseInt(n.top)+"px",m.left=parseInt(n.left)+"px",m.height=parseInt(n.height)+"px",m.fontSize=k.attributes["font-size"].nodeValue+"px",m.width=parseInt(n.width+30)+"px",m.padding=0,l.value=k.textContent,l.referenciaCell=h,l.referenciaEditable=i[j],l.classList.add("volame"),l.onblur=function(a){this.referenciaCell.set(this.referenciaEditable,this.value),this.id="sacame",$("#sacame").remove()},l.onfocus=function(a){this.classList.remove("volame"),$(".volame").remove()}}}}),a.importar=function(b){var c=b.target.files[0],d=new FileReader;d.onload=function(b){return function(b){var c=JSON.parse(b.target.result);a.diagrama.fromJSON(c),a.enlaces=c.enlaces,console.log(a.enlaces)}}(c),d.readAsText(c)},a.exportar=function(){var b=a.diagrama.toJSON();b.enlaces=a.enlaces;var c=JSON.stringify(b),d=document.createElement("a");d.href=window.URL.createObjectURL(new Blob([c],{type:"text/json"})),d.setAttribute("download","diagrama.json"),document.body.appendChild(d),d.click(),document.body.removeChild(d)},a.papel_diagrama.el.addEventListener("mousedown",function(b){""!==a.modo&&b.stopPropagation()},!0),a.diagrama.clear(),window.enlaces=a.enlaces={},a.diagrama.on("add",function(b){"link"==b.attributes.type&&(a.enlaces[b.id]="")}),a.diagrama.on("remove",function(b){"link"==b.attributes.type&&delete a.enlaces[b.id]}),a.diagrama.on("change:source change:target",function(b){var c=b.get("target");if(c.id){var d=b.get("source"),e=d.port,f=a.diagrama.getCell(d.id).attr(".label/text"),g=b.get("target").port,h=a.diagrama.getCell(c.id).attr(".label/text"),i=f+"."+e,j=h+"."+g;a.enlaces[b.id]={textual:i+" --> "+j,logico:d.id+" --> "+c.id}}})}]),angular.module("firebase.config",[]).constant("FBURL","https://shining-inferno-8432.firebaseio.com").constant("SIMPLE_LOGIN_PROVIDERS",["github"]).constant("loginRedirectPath","/"),angular.module("firebase.utils",["firebase","firebase.config"]).factory("fbutil",["$window","FBURL","$firebase",function(a,b,c){function d(a){for(var b=0;b<a.length;b++)if(angular.isArray(a[b]))a[b]=d(a[b]);else if("string"!=typeof a[b])throw new Error("Argument "+b+" to firebaseRef is not a string: "+a[b]);return a.join("/")}function e(c){var e=new a.Firebase(b),f=Array.prototype.slice.call(arguments);return f.length&&(e=e.child(d(f))),e}function f(a,b){var d=e(a);return b=angular.extend({},b),angular.forEach(["limit","startAt","endAt"],function(a){if(b.hasOwnProperty(a)){var c=b[a];d=d[a].apply(d,angular.isArray(c)?c:[c]),delete b[a]}}),c(d,b)}return{syncObject:function(a,b){return f.apply(null,arguments).$asObject()},syncArray:function(a,b){return f.apply(null,arguments).$asArray()},ref:e}}]),angular.module("diagramasApp").controller("ChatCtrl",["$scope","fbutil","$timeout",function(a,b,c){function d(b){a.err=b,c(function(){a.err=null},5e3)}a.messages=b.syncArray("messages",{limit:10}),a.messages.$loaded()["catch"](d),a.addMessage=function(b){b&&a.messages.$add({text:b})["catch"](d)}}]),angular.module("diagramasApp").filter("capitalize",function(){return function(a,b){return a?a.replace(/([^\W_]+[^\s-]*) */g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()}):""}}),function(){angular.module("simpleLogin",["firebase","firebase.utils","firebase.config"]).factory("authRequired",["simpleLogin","$q",function(a,b){return function(){return a.getUser().then(function(a){return a?a:b.reject({authRequired:!0})})}}]).factory("simpleLogin",["$firebaseSimpleLogin","fbutil","$q","$rootScope","createProfile","changeEmail",function(a,b,c,d,e,f){function g(){j.initialized=!0,j.user=h.user||null,angular.forEach(i,function(a){a(j.user)})}var h=a(b.ref()),i=[],j={user:null,initialized:!1,getUser:function(){return h.$getCurrentUser()},login:function(a,b){return h.$login(a,b)},logout:function(){h.$logout()},createAccount:function(a,b,c){return h.$createUser(a,b).then(function(){return j.login("password",{email:a,password:b})}).then(function(b){return e(b.uid,a,c).then(function(){return b})})},changePassword:function(a,b,c){return h.$changePassword(a,b,c)},changeEmail:function(a,b){return f(a,j.user.email,b,this)},removeUser:function(a,b){return h.$removeUser(a,b)},watch:function(a,b){i.push(a),j.getUser().then(function(b){a(b)});var c=function(){var b=i.indexOf(a);b>-1&&i.splice(b,1)};return b&&b.$on("$destroy",c),c}};return d.$on("$firebaseSimpleLogin:login",g),d.$on("$firebaseSimpleLogin:logout",g),d.$on("$firebaseSimpleLogin:error",g),h.$getCurrentUser(g),j}]).factory("createProfile",["fbutil","$q","$timeout",function(a,b,c){return function(d,e,f){function g(a){return h(a.substr(0,a.indexOf("@"))||"")}function h(a){a+="";var b=a.charAt(0).toUpperCase();return b+a.substr(1)}var i=a.ref("users",d),j=b.defer();return i.set({email:e,name:f||g(e)},function(a){c(function(){a?j.reject(a):j.resolve(i)})}),j.promise}}]).factory("changeEmail",["fbutil","$q",function(a,b){return function(c,d,e,f){function g(){return f.login("password",{email:n.old.email,password:c}).then(function(a){n.old.uid=a.uid})}function h(){var c=b.defer();return n.old.ref=a.ref("users",n.old.uid),n.old.ref.once("value",function(a){var b=a.val();null===b?c.reject(d+" not found"):(n.old.name=b.name,n.curr.name=b.name,c.resolve())},function(a){c.reject(a)}),c.promise}function i(){return f.createAccount(n.curr.email,c,n.old.name).then(function(a){n.curr.uid=a.uid})}function j(){var c=b.defer();n.curr.ref=a.ref("users",n.curr.uid);var d={email:n.curr.email,name:n.curr.name};return n.curr.ref.set(d,function(a){a?c.reject(a):c.resolve()}),c.promise}function k(){var a=b.defer();return n.old.ref.remove(function(b){b?a.reject(b):a.resolve()}),a.promise}function l(){var a=b.defer();return f.removeUser(n.old.email,c).then(function(){a.resolve()},function(b){a.reject(b)}),a.promise}function m(){return f.login("password",{email:n.curr.email,password:c})}var n={old:{email:d},curr:{email:e}};return g().then(h).then(i).then(j).then(g).then(k).then(l).then(m)["catch"](function(a){return console.error(a),b.reject(a)})}}])}(),angular.module("diagramasApp").controller("LoginCtrl",["$scope","simpleLogin","$location",function(a,b,c){function d(d,e){a.err=null,b.login(d,e).then(function(){c.path("/account")},function(b){a.err=b})}a.oauthlogin=function(a){d(a,{rememberMe:!0})},a.passwordLogin=function(a,b){d("password",{email:a,password:b,rememberMe:!0})},a.createAccount=function(d,e,f){a.err=null,e?e!==f?a.err="Passwords do not match":b.createAccount(d,e).then(function(){c.path("/account")},function(b){a.err=b}):a.err="Please enter a password"}}]),angular.module("diagramasApp").controller("AccountCtrl",["$scope","user","simpleLogin","fbutil","$timeout",function(a,b,c,d,e){function f(a){h(a,"danger")}function g(a){h(a,"success")}function h(b,c){var d={text:b,type:c};a.messages.unshift(d),e(function(){a.messages.splice(a.messages.indexOf(d),1)},1e4)}function i(b){a.profile&&a.profile.$destroy(),d.syncObject("users/"+b.uid).$bindTo(a,"profile")}a.user=b,a.logout=c.logout,a.messages=[],i(b),a.changePassword=function(d,e,h){a.err=null,d&&e?e!==h?f("Passwords do not match"):c.changePassword(b.email,d,e).then(function(){g("Password changed")},f):f("Please enter all fields")},a.changeEmail=function(b,d){a.err=null,c.changeEmail(b,d).then(function(a){i(a),g("Email changed")})["catch"](f)}}]),angular.module("diagramasApp").directive("ngShowAuth",["simpleLogin","$timeout",function(a,b){var c;return a.watch(function(a){c=!!a}),{restrict:"A",link:function(d,e){function f(){b(function(){e.toggleClass("ng-cloak",!c)},0)}e.addClass("ng-cloak"),a.watch(f,d),a.getUser(f)}}}]),angular.module("diagramasApp").directive("ngHideAuth",["simpleLogin","$timeout",function(a,b){var c;return a.watch(function(a){c=!!a}),{restrict:"A",link:function(d,e){function f(){b(function(){e.toggleClass("ng-cloak",c!==!1)},0)}e.addClass("ng-cloak"),a.watch(f,d),a.getUser(f)}}}]),angular.module("diagramasApp").config(["$routeProvider","SECURED_ROUTES",function(a,b){a.whenAuthenticated=function(c,d){return d.resolve=d.resolve||{},d.resolve.user=["authRequired",function(a){return a()}],a.when(c,d),b[c]=!0,a}}]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/chat",{templateUrl:"views/chat.html",controller:"ChatCtrl"}).whenAuthenticated("/account",{templateUrl:"views/account.html",controller:"AccountCtrl"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","simpleLogin","SECURED_ROUTES","loginRedirectPath",function(a,b,c,d,e){function f(a){!a&&g(b.path())&&b.path(e)}function g(a){return d.hasOwnProperty(a)}c.watch(f,a),a.$on("$routeChangeError",function(a,c,d,f){angular.isObject(f)&&f.authRequired&&b.path(e)})}]).constant("SECURED_ROUTES",{}),angular.module("diagramasApp").directive("figura",function(){return{template:'<svg version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg"></svg>',restrict:"E",scope:{figura:"=figura"},link:function(a,b,c){b.children().attr("width",a.figura.ancho),b.children().attr("height",a.figura.alto),b.children().append(angular.element(a.figura)),b.attr("ng-drag",!0)}}}),angular.module("diagramasApp").run(["joint",function(a){}]).factory("joint",["$window",function(a){var b=a.joint;a.V;b.shapes.devs={},b.shapes.devs.Modeloo=b.shapes.basic.Generic.extend(b.plugins.TooledModelInterface),b.shapes.devs.Model=b.shapes.devs.Modeloo.extend(_.extend({},b.shapes.basic.PortsModelInterface,{markup:'<g class="rotatable"><g class="scalable"><rect class="body"/></g><text class="label"/><g class="inPorts"/><g class="outPorts"/><g class="portsTool"/><g class="resizeTool"/><g class="moveTool"/></g>',portMarkup:'<g class="port port<%= id %>"><rect class="port-body"/><text class="port-label"/><text></text></g>',defaults:b.util.deepSupplement({type:"devs.Model",inPorts:[],outPorts:[],attrs:{".":{magnet:"false"},".body":{width:100,height:100,"follow-scale":"true",stroke:"#000000"},".port-body":{magnet:"true",stroke:"#000000",width:20,height:20,x:-10,y:-10},text:{"pointer-events":"none"},".label":{"ref-x":.5,"ref-y":10,ref:".body","text-anchor":"middle",fill:"#000"},".outPorts .port-label":{x:15,fill:"#000"},".inPorts .port-label":{x:-15,"text-anchor":"end"}}},b.shapes.basic.Generic.prototype.defaults),getPortAttrs:function(a,b,c,d,e){var f={},g="port"+b,h=d+">."+g,i=h+">.port-label",j=h+">.port-body";return f[i]={text:a},f[j]={port:{id:a||_.uniqueId(e),type:e}},f[h]={ref:".body","ref-y":(b+.5)*(1/c)},".outPorts"===d&&(f[h]["ref-dx"]=0),f}})),b.shapes.devs.Link=b.dia.Link.extend({defaults:{type:"link",attrs:{".connection":{stroke:"black","stroke-width":3},".marker-target":{stroke:"black",fill:"black",d:"M 10 0 L 0 5 L 10 10 z"}}}});var c=b.dia.ElementView.extend(b.shapes.basic.PortsViewInterface);return b.shapes.devs.ModelView=c.extend(b.plugins.TooledViewInterface),b}]),angular.module("diagramasApp").factory("elementosJoint",["joint",function(a){return a.shapes.elementos={},a.shapes.uml||(a.shapes.uml={}),a.shapes.uml.Class=a.shapes.basic.Generic.extend({markup:['<g class="rotatable">','<g class="scalable">','<rect class="uml-class-name-rect"/><rect class="uml-class-attrs-rect"/><rect class="uml-class-methods-rect"/>',"</g>",'<text class="uml-class-name-text"/><text class="uml-class-attrs-text"/><text class="uml-class-methods-text"/>',"</g>"].join(""),defaults:a.util.deepSupplement({type:"uml.Class",size:{width:100,height:90},attrs:{rect:{width:200},".uml-class-name-rect":{stroke:"black","stroke-width":2,fill:"#3498db"},".uml-class-attrs-rect":{stroke:"black","stroke-width":2,fill:"#2980b9"},".uml-class-methods-rect":{stroke:"black","stroke-width":2,fill:"#2980b9"},".uml-class-name-text":{ref:".uml-class-name-rect","ref-y":.5,"ref-x":.5,"text-anchor":"middle","y-alignment":"middle","font-weight":"bold",fill:"black","font-size":12,"font-family":"Times New Roman"},".uml-class-attrs-text":{ref:".uml-class-attrs-rect","ref-y":5,"ref-x":5,fill:"black","font-size":12,"font-family":"Times New Roman"},".uml-class-methods-text":{ref:".uml-class-methods-rect","ref-y":5,"ref-x":5,fill:"black","font-size":12,"font-family":"Times New Roman"}},name:[],attributes:["atributos[] :String"],methods:["+ getAlgo():Type","+ setAlgo():Type"]},a.shapes.basic.Generic.prototype.defaults),editables:["name","attributes","methods"],editablesRenderizadosEnVista:[".uml-class-name-text/text",".uml-class-attributes-text/text",".uml-class-methods-text/text"],initialize:function(){this.on("change:name change:attributes change:methods",function(){this.updateRectangles(),this.trigger("uml-update")},this),this.updateRectangles(),a.shapes.basic.Generic.prototype.initialize.apply(this,arguments)},getClassName:function(){return this.get("name")},updateRectangles:function(){var a=this.get("attrs"),b=[{type:"name",text:this.getClassName()},{type:"attrs",text:this.get("attributes")},{type:"methods",text:this.get("methods")}],c=0;_.each(b,function(b){var d=_.isArray(b.text)?b.text:[b.text],e=20*d.length+20;a[".uml-class-"+b.type+"-text"].text=d.join("\n"),a[".uml-class-"+b.type+"-rect"].height=e,a[".uml-class-"+b.type+"-rect"].transform="translate(0,"+c+")",c+=e})}}),a.shapes.uml.ClassView=a.dia.ElementView.extend({initialize:function(){a.dia.ElementView.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"uml-update",function(){this.update(),this.resize()})}}),a.shapes.uml.Abstract=a.shapes.uml.Class.extend({defaults:a.util.deepSupplement({type:"uml.Abstract",attrs:{".uml-class-name-rect":{fill:"#e74c3c"},".uml-class-attrs-rect":{fill:"#c0392b"},".uml-class-methods-rect":{fill:"#c0392b"}}},a.shapes.uml.Class.prototype.defaults),getClassName:function(){return["<<Abstract>>",this.get("name")]}}),a.shapes.uml.AbstractView=a.shapes.uml.ClassView,a.shapes.uml.Interface=a.shapes.uml.Class.extend({defaults:a.util.deepSupplement({type:"uml.Interface",attrs:{".uml-class-name-rect":{fill:"#f1c40f"},".uml-class-attrs-rect":{fill:"#f39c12"},".uml-class-methods-rect":{fill:"#f39c12"}}},a.shapes.uml.Class.prototype.defaults),getClassName:function(){return["<<Interface>>",this.get("name")]}}),a.shapes.uml.InterfaceView=a.shapes.uml.ClassView,a.shapes.uml.State=a.shapes.basic.Generic.extend({markup:['<g class="rotatable">','<g class="scalable">','<rect class="uml-state-body"/>',"</g>",'<path class="uml-state-separator"/>','<text class="uml-state-name"/>','<text class="uml-state-events"/>',"</g>"].join(""),defaults:a.util.deepSupplement({type:"uml.State",size:{width:100,height:90},attrs:{".uml-state-body":{width:200,height:200,rx:10,ry:10,fill:"#ecf0f1",stroke:"#bdc3c7","stroke-width":3},".uml-state-separator":{stroke:"#bdc3c7","stroke-width":2},".uml-state-name":{ref:".uml-state-body","ref-x":.5,"ref-y":5,"text-anchor":"middle",fill:"#000000","font-family":"Courier New","font-size":14},".uml-state-events":{ref:".uml-state-separator","ref-x":5,"ref-y":5,fill:"#000000","font-family":"Courier New","font-size":14}},name:"State",events:[]},a.shapes.basic.Generic.prototype.defaults),initialize:function(){this.on({"change:name":this.updateName,"change:events":this.updateEvents,"change:size":this.updatePath},this),this.updateName(),this.updateEvents(),this.updatePath(),a.shapes.basic.Generic.prototype.initialize.apply(this,arguments)},updateName:function(){this.attr(".uml-state-name/text",this.get("name"))},updateEvents:function(){this.attr(".uml-state-events/text",this.get("events").join("\n"))},updatePath:function(){var a="M 0 20 L "+this.get("size").width+" 20";this.attr(".uml-state-separator/d",a,{silent:!0})}}),a.shapes.uml.StartState=a.shapes.basic.Circle.extend({defaults:a.util.deepSupplement({type:"uml.StartState",size:{width:20,height:20},attrs:{circle:{fill:"#34495e",stroke:"#2c3e50","stroke-width":2,rx:1}}},a.shapes.basic.Circle.prototype.defaults)}),a.shapes.uml.EndState=a.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><circle class="outer"/><circle class="inner"/></g></g>',defaults:a.util.deepSupplement({type:"uml.EndState",size:{width:20,height:20},attrs:{"circle.outer":{transform:"translate(10, 10)",r:10,fill:"#ffffff",stroke:"#2c3e50"},"circle.inner":{transform:"translate(10, 10)",r:6,fill:"#34495e"}}},a.shapes.basic.Generic.prototype.defaults)}),a.shapes.elementos.Base=a.shapes.devs.Model.extend({defaults:a.util.deepSupplement({type:"elementos.Base",size:{width:110,height:110},inPorts:[],outPorts:[],attrs:{".body":{fill:"#90b42d",rx:2,ry:2,magnet:"true"},".label":{text:"Nombrame","ref-y":.5,"y-alignment":"middle",fill:"#260b81","font-size":22},".inPorts .port-label":{fill:"#004","font-weight":"bold"},".inPorts rect":{fill:"#f25242"},".outPorts rect":{fill:"#983126"}},nombre:"Nombrame"},a.shapes.devs.Model.prototype.defaults),editables:["nombre"],editablesRenderizadosEnVista:[".label"],initialize:function(){for(var a=this.constructor.__super__;!a.hasOwnProperty("initialize");)a=a.constructor.__super__;a.initialize.apply(this,arguments),this.on("change:nombre",function(a,b,c){this.attr(".label/text",b)})}}),a.shapes.elementos.Contenedor=a.shapes.devs.Model.extend({portMarkup:'<g class="port port<%= id %>"><rect class="port-body"/><text class="port-label"/></g>',moveTool:!1,defaults:a.util.deepSupplement({type:"elementos.Contenedor",size:{width:190,height:100},inPorts:[],outPorts:[],attrs:{".body":{fill:"rgba(0,0,0,0.04)",rx:3,ry:3},".label":{text:"Nombrame",ref:".body","ref-x":10,"ref-y":2,"x-alignment":"left","y-alignment":"top","text-anchor":"left",fill:"#000","font-size":22},".port-body":{magnet:"true",stroke:"#000000",height:20,x:-10,y:-10},".inPorts .port-body":{fill:"rgba(240,170,170,1)"},".outPorts .port-body":{fill:"rgba(170,240,170,1)"},".inPorts .port-label":{fill:"#004","font-size":14,"font-weight":"bold","text-anchor":"start",x:-5,"ref-y":5}},nombre:"Nombrame"},a.shapes.devs.Model.prototype.defaults),editables:["nombre"],editablesRenderizadosEnVista:[".label"],initialize:function(){for(var a=this.constructor.__super__;!a.hasOwnProperty("initialize");)a=a.constructor.__super__;a.initialize.apply(this,arguments),this.on("change:nombre",function(a,b,c){this.attr(".label/text",b)})},getPortAttrs:function(b,c,d,e,f){var g=a.shapes.devs.Model.prototype.getPortAttrs.apply(this,arguments);return".inPorts"===e&&(g[e+">.port"+c]["ref-y"]=(c+.7)*(1/d)),g}}),a.shapes.elementos.BaseView=a.shapes.devs.ModelView,a.shapes.elementos.ContenedorView=a.shapes.devs.ModelView.extend({update:function(){a.shapes.devs.ModelView.prototype.update.apply(this,arguments);for(var b=this.$(".inPorts .port"),c=0;c<b.length;c++){var d=b[c].children[0],e=b[c].children[1];d.setAttribute("width",e.getBBox().width+10)}}}),{Proceso:a.shapes.elementos.Base,Contenedor:a.shapes.elementos.Contenedor}}]),angular.module("diagramasApp").factory("enlacesJoint",["joint",function(a){return a.shapes.uml||(a.shapes.uml={}),a.shapes.uml.Transition=a.dia.Link.extend({defaults:{type:"uml.Transition",attrs:{".marker-target":{d:"M 10 0 L 0 5 L 10 10 z",fill:"#34495e",stroke:"#2c3e50"},".connection":{stroke:"#2c3e50"}}}}),a.shapes.uml.Generalization=a.dia.Link.extend({defaults:{type:"uml.Generalization",attrs:{".marker-target":{d:"M 20 0 L 0 10 L 20 20 z",fill:"white"}}}}),a.shapes.uml.Implementation=a.dia.Link.extend({defaults:{type:"uml.Implementation",attrs:{".marker-target":{d:"M 20 0 L 0 10 L 20 20 z",fill:"white"},".connection":{"stroke-dasharray":"3,3"}}}}),a.shapes.uml.Aggregation=a.dia.Link.extend({defaults:{type:"uml.Aggregation",attrs:{".marker-target":{d:"M 40 10 L 20 20 L 0 10 L 20 0 z",fill:"white"}}}}),a.shapes.uml.Composition=a.dia.Link.extend({defaults:{type:"uml.Composition",attrs:{".marker-target":{d:"M 40 10 L 20 20 L 0 10 L 20 0 z",fill:"black"}}}}),a.shapes.uml.Association=a.dia.Link.extend({defaults:{type:"uml.Association"}}),a.shapes.uml.Flecha=a.dia.Link.extend({defaults:{type:"uml.Flecha",attrs:{".connection":{stroke:"black","stroke-width":3},".marker-target":{stroke:"black",fill:"black",d:"M 10 0 L 0 5 L 10 10 z"}}}}),{}}]),angular.module("diagramasApp").directive("herramienta",["$compile",function(a){return{template:'<img src="{{imagen}}" activo="{{modo == operacion}}"></img><span data-tooltip aria-haspopup="true" class="has-tip" title="Hace doble click sobre los elementos">{{operacion | capitalize}}</span></div>',restrict:"E",scope:{operacion:"@",imagen:"@",modo:"=varModo"},link:function(a,b,c){b.children().on("click",function(b){a.$apply(function(){a.modo=a.modo==a.operacion?"":a.operacion})})}}}]),angular.module("diagramasApp").directive("conector",function(){return{template:'<svg version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="120px" height="90px" id="conector{{indice}}"></svg>',restrict:"E",scope:{conector:"=",seleccionarConector:"&funcionConectora",indice:"@"},link:function(a,b,c){b.children().append(angular.element(a.conector));var d=b.children().children()[0].childNodes;d[7].remove(),d[6].remove(),d[5].remove(),a.elegido=!1,b.on("click",function(b){a.elegido=!a.elegido,a.seleccionarConector(a.elegido?a.indice:"")})}}}),angular.module("diagramasApp").directive("operacion",[function(){return{template:"<div id=\"{{ tipo == 'importar' ? 'file-image' : ''}}\"><input type=\"file\" required accept=\"application/json\"><img src=\"{{imagen || 'images/' + tipo + '.png'}}\"></img><span>{{tipo | capitalize}}</span></div>",restrict:"E",scope:{tipo:"@",imagen:"@"},controller:["$scope",function(a){if(!a.$parent.exportar||!a.$parent.exportar)throw new Error('La directiva "operacion" deberia ser usada sobre el ambito del $scope que contenga las variables del diagrama');a.importar=function(b){var c=b.target.files[0],d=new FileReader;d.onload=function(){return function(b){var c=JSON.parse(b.target.result);a.$parent.diagrama.fromJSON(c),a.$parent.enlaces=c.enlaces,console.log(a.$parent.enlaces)}}(c),d.readAsText(c)},a.exportar=function(){var b=a.$parent.diagrama.toJSON();b.enlaces=a.$parent.enlaces;var b=JSON.stringify(b),c=document.createElement("a");c.href=window.URL.createObjectURL(new Blob([b],{type:"text/json"})),c.setAttribute("download","diagrama.json"),document.body.appendChild(c),c.click(),document.body.removeChild(c)}}],link:function(a,b){var c=b.find("input");switch(a.tipo){case"importar":c.on("change",a.importar);break;case"exportar":c.remove(),b.on("click",a.exportar)}}}}]);